@using WebApp.Models
@model WebApp.Models.SearchData
@using WebApp.Content

@{
    /**/

    ViewBag.Title = "GetResults";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var resList = Model.ResultList as List<WebApp.Models.Documents.ReportDocument>;
    var count = 5;
    count = resList.Count();
}

<head>
    <style type="text/css">
        table {
            width: 100%;
            border-collapse: collapse;
        }

        .scrollingTable {
            overflow-y: auto;
        }

        input {
            border: 0;
        }

        summary {
            width: 100%;
        }
    </style>
    <script type="text/javascript">
        var mod = @Html.Raw(Json.Encode(Model));

        function updateSummary(id) {
            var summary = "";

            var i;
            for (i = 0; i < mod.ResultList.length; i++) {
                if (mod.ResultList[i].Id == id) {
                    summary = mod.ResultList[i].Summary;
                }
            }
            document.getElementById('summaryTb').value = summary;
        }

        function openDocument(id) {
            var i;
            var link = "";
            for (i = 0; i < mod.ResultList.length; i++) {
                if (mod.ResultList[i].Id == id) {
                    link = mod.ResultList[i].ExternalLink;
                }
            }
            if (!link.includes("www")) {
                alert("Not correct link format");
            }
            else {
                window.open(link, '_blank');
            }
            @*document.getElementById('summaryTb').value = link;*@

        }

        function makeTableScroll() {
            // Constant retrieved from server-side via JSP
            var maxRows = 10;
            var table = document.getElementById('ResultTable');
            var wrapper = table.parentNode;
            var rowsInTable = table.rows.length;
            var height = 0;
            if (rowsInTable > maxRows) {
                for (var i = 0; i < maxRows; i++) {
                    height += table.rows[i].clientHeight;
                }
                wrapper.style.height = height + "px";
            }
        }
    </script>
</head>


<body onload="makeTableScroll();">
    <div class="jumbotron">
        <div class="h4 pb-3">Results</div>
        <div class="h6 pb-3">Returned @Model.ResultList.Count hits</div>
        <div class="results">
            @foreach (var item in Model.ResultList)
            {
                <div class="card text-left m-3">
                    <font size="+1">
                        @if (!item.ExternalLink.Contains("www"))
                        {
                            @*<a href=@item.ExternalLink target="_blank"> @item.Name </a>*@
                            <a href=http://firda.no target="_blank"> @item.Name </a>
                        }
                        else
                        {
                            @Html.DisplayFor(modelItem => item.Name)
                        }
                    </font>
                    @if (item.Author.ToString() != "")
                    {
                        @Html.DisplayFor(modelItem => item.Author)
                        <br />
                    }

                    @if (item.Date.ToString() != "")
                    {
                        @Html.DisplayFor(modelItem => item.Date)
                        <br />
                    }

                    @if (item.Keywords.ToString() != "")
                    {
                        <span>Keywords:  @Html.DisplayFor(modelItem => item.Keywords)</span>
                    }
                    @if (item.Publisher.ToString() != "")
                    {
                        @Html.DisplayFor(modelItem => item.Publisher)
                    }

                    @*<a href="#" id=@item.Id onclick="updateSummary(this.id)"> Summary </a>*@
                </div>
            }


            @*
            <div class="h4 pb-3">Summary</div>
            <textarea id="summaryTb" value="" readonly="readonly" rows="10" cols="50" wrap="soft"></textarea>
            <br />
            <br />
            *@
        </div>
    </div>
</body>

